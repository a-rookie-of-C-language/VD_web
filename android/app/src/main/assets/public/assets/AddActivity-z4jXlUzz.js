import{d as z,u as H,r as S,a as O,g as W,o as Y,E as m,b as G,c as U,e as t,w as l,f as r,h as p,i as d,F as J,j as K,k as B,l as k,p as Q,m as D,t as X,n as Z,_ as ee}from"./index-W60BvozO.js";const te={class:"add-activity-page"},ae=["src"],le={class:"input-wrapper"},ne=z({__name:"AddActivity",setup(oe){const T=G(),c=H(),M=c.role,q=c.studentNo,b=S(),a=O({name:"",type:"",description:"",enrollmentStartTime:"",enrollmentEndTime:"",startTime:"",extendEndTime:"",maxParticipants:10,coverImage:null,duration:0}),f=S(!1),V=S(""),P=W(),$={name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],type:[{required:!0,message:"请选择活动类型",trigger:"change"}],description:[{required:!0,message:"请输入活动描述",trigger:"blur"}],enrollmentStartTime:[{required:!0,message:"请选择报名开始时间",trigger:"change"}],enrollmentEndTime:[{required:!0,message:"请选择报名结束时间",trigger:"change"}],startTime:[{required:!0,message:"请选择活动开始时间",trigger:"change"}],expectedEndTime:[{required:!0,message:"请选择活动结束时间",trigger:"change"}],duration:[{required:!0,message:"请输入志愿时长",trigger:"change"}]};Y(async()=>{c.currentUser||await c.loadUserInfo(),M.value!=="functionary"&&(m.warning("仅负责人可以发布活动"),await T.push("/activities"))});const g=s=>{if(!s)return"";const e=new Date(s),i=E=>E.toString().padStart(2,"0"),_=e.getFullYear(),u=i(e.getMonth()+1),o=i(e.getDate()),x=i(e.getHours()),w=i(e.getMinutes()),h=i(e.getSeconds());return`${_}-${u}-${o}T${x}:${w}:${h}+08:00`},N=s=>{if(s.raw){const e=new FileReader;e.onload=i=>{V.value=String(i.target?.result||"")},e.readAsDataURL(s.raw),a.coverImage=s.raw}},R=s=>s.type.startsWith("image/")?s.size/1024/1024>20?(m.error("图片大小不能超过 20MB!"),!1):!0:(m.error("只能上传图片文件!"),!1),F=async()=>{b.value&&await b.value.validate(async s=>{if(s){f.value=!0;try{const e={functionary:q.value,name:a.name,type:a.type,description:a.description,enrollmentStartTime:g(a.enrollmentStartTime),enrollmentEndTime:g(a.enrollmentEndTime),startTime:g(a.startTime),expectedEndTime:g(a.extendEndTime),maxParticipants:a.maxParticipants,attachment:[],participants:[],duration:a.duration,coverFile:a.coverImage};await Z.createActivity(e),m.success("活动创建成功!"),await T.push("/activities")}catch(e){console.error("Failed to create activity:",e),m.error(e.message||"创建活动失败")}finally{f.value=!1}}})},j=()=>{T.back()};return(s,e)=>{const i=r("el-card"),_=r("el-divider"),u=r("el-input"),o=r("el-form-item"),x=r("el-option"),w=r("el-select"),h=r("el-icon"),E=r("el-upload"),v=r("el-date-picker"),y=r("el-col"),A=r("el-row"),C=r("el-input-number"),I=r("el-button"),L=r("el-form");return p(),U("div",te,[t(i,{class:"page-header"},{default:l(()=>[...e[9]||(e[9]=[d("h1",{class:"page-title"},"发布新活动",-1)])]),_:1}),t(i,{class:"form-container"},{default:l(()=>[t(L,{ref_key:"formRef",ref:b,model:a,rules:$,"label-width":"120px","label-position":"right"},{default:l(()=>[t(_,{"content-position":"left"},{default:l(()=>[...e[10]||(e[10]=[d("span",{class:"section-title"},"基本信息",-1)])]),_:1}),t(o,{label:"活动名称",prop:"name"},{default:l(()=>[t(u,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.name=n),placeholder:"请输入活动名称",clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"活动类型",prop:"type"},{default:l(()=>[t(w,{modelValue:a.type,"onUpdate:modelValue":e[1]||(e[1]=n=>a.type=n),placeholder:"请选择活动类型",clearable:"",style:{width:"100%"}},{default:l(()=>[(p(!0),U(J,null,K(k(P),n=>(p(),B(x,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(o,{label:"负责人(学号)"},{default:l(()=>[t(u,{"model-value":k(q),disabled:""},null,8,["model-value"])]),_:1}),t(o,{label:"活动描述",prop:"description"},{default:l(()=>[t(u,{modelValue:a.description,"onUpdate:modelValue":e[2]||(e[2]=n=>a.description=n),type:"textarea",rows:4,placeholder:"请输入活动详细描述"},null,8,["modelValue"])]),_:1}),t(o,{label:"封面图片"},{default:l(()=>[t(E,{class:"cover-uploader","auto-upload":!1,"show-file-list":!1,"on-change":N,"before-upload":R,accept:"image/*"},{default:l(()=>[V.value?(p(),U("img",{key:0,src:V.value,class:"cover-image",alt:""},null,8,ae)):(p(),B(h,{key:1,class:"cover-uploader-icon"},{default:l(()=>[t(k(Q))]),_:1}))]),_:1}),e[11]||(e[11]=d("div",{class:"upload-tip"},"支持 jpg、png 格式,大小不超过 20MB",-1))]),_:1}),t(_,{"content-position":"left"},{default:l(()=>[...e[12]||(e[12]=[d("span",{class:"section-title"},"时间与名额",-1)])]),_:1}),t(A,{gutter:20},{default:l(()=>[t(y,{span:12,xs:24},{default:l(()=>[t(o,{label:"报名开始时间",prop:"enrollmentStartTime"},{default:l(()=>[t(v,{modelValue:a.enrollmentStartTime,"onUpdate:modelValue":e[3]||(e[3]=n=>a.enrollmentStartTime=n),type:"datetime",placeholder:"选择报名开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(y,{span:12,xs:24},{default:l(()=>[t(o,{label:"报名结束时间",prop:"enrollmentEndTime"},{default:l(()=>[t(v,{modelValue:a.enrollmentEndTime,"onUpdate:modelValue":e[4]||(e[4]=n=>a.enrollmentEndTime=n),type:"datetime",placeholder:"选择报名结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(A,{gutter:20},{default:l(()=>[t(y,{span:12,xs:24},{default:l(()=>[t(o,{label:"活动开始时间",prop:"startTime"},{default:l(()=>[t(v,{modelValue:a.startTime,"onUpdate:modelValue":e[5]||(e[5]=n=>a.startTime=n),type:"datetime",placeholder:"选择活动开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(y,{span:12,xs:24},{default:l(()=>[t(o,{label:"活动结束时间",prop:"endTime"},{default:l(()=>[t(v,{modelValue:a.extendEndTime,"onUpdate:modelValue":e[6]||(e[6]=n=>a.extendEndTime=n),type:"datetime",placeholder:"选择预期活动结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(o,{label:"最大参与人数",prop:"maxParticipants",class:"responsive-form-item"},{default:l(()=>[d("div",le,[t(C,{modelValue:a.maxParticipants,"onUpdate:modelValue":e[7]||(e[7]=n=>a.maxParticipants=n),min:1,style:{width:"100%","max-width":"200px"}},null,8,["modelValue"]),e[13]||(e[13]=d("span",{class:"hint-text"}," 为0表示不限制人数",-1))])]),_:1}),t(o,{label:"志愿时长",prop:"duration"},{default:l(()=>[t(C,{modelValue:a.duration,"onUpdate:modelValue":e[8]||(e[8]=n=>a.duration=n),min:.5,style:{width:"100%","max-width":"200px"}},null,8,["modelValue"])]),_:1}),t(o,{class:"form-actions"},{default:l(()=>[t(I,{type:"primary",loading:f.value,onClick:F,class:"action-btn"},{default:l(()=>[D(X(f.value?"发布中...":"发布活动"),1)]),_:1},8,["loading"]),t(I,{onClick:j,class:"action-btn"},{default:l(()=>[...e[14]||(e[14]=[D("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),se=ee(ne,[["__scopeId","data-v-2cdac806"]]);export{se as default};
