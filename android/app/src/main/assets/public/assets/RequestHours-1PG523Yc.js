import{d as X,r as _,a as Y,g as Z,o as ee,q as te,c as f,e as l,i as n,w as s,f as o,n as S,h as d,F as C,j as B,k as T,l as k,p as le,m as p,B as se,C as ae,t as m,K as ne,H as v,E as R,_ as oe}from"./index-W60BvozO.js";const ie={class:"request-hours-page"},re={class:"content-container"},de={class:"request-list"},ue={key:1,class:"card-list"},pe={class:"card-header"},me={class:"req-name"},ce={class:"card-body"},fe={class:"info-row"},_e={class:"info-row"},ve={class:"info-row"},ge={class:"info-row desc"},ye={key:0,class:"reject-reason"},be=X({__name:"RequestHours",setup(we){const g=_("submit"),c=_(!1),y=_([]),U=_(),x=_("right"),a=Y({name:"",functionary:"",type:"",description:"",startTime:"",endTime:"",duration:0,files:[]}),D=Z(),L={name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],functionary:[{required:!0,message:"请输入证明人/负责人",trigger:"blur"}],type:[{required:!0,message:"请选择活动类型",trigger:"change"}],description:[{required:!0,message:"请输入活动简述",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],duration:[{required:!0,message:"请输入志愿时长",trigger:"change"}]},j=(i,e)=>{a.files=e},z=(i,e)=>{a.files=e},H=async i=>{i&&await i.validate(async e=>{if(e){if(a.files.length===0){R.warning("请至少上传一份证明材料");return}c.value=!0;try{await S.requestHours({...a,files:a.files.map(u=>u.raw)}),R.success("申请提交成功，请等待审核"),i.resetFields(),a.files=[],g.value="list",q()}catch(u){console.error(u),R.error("提交失败")}finally{c.value=!1}}})},q=async()=>{c.value=!0;try{y.value=await S.getMyRequests()}catch(i){console.error(i)}finally{c.value=!1}},M=i=>i===v.FailReview?"danger":i===v.UnderReview?"warning":"success",N=i=>i===v.FailReview?"审核未通过":i===v.UnderReview?"审核中":"已通过",b=()=>{x.value=window.innerWidth<=768?"top":"right"};return ee(()=>{b(),window.addEventListener("resize",b),q()}),te(()=>{window.removeEventListener("resize",b)}),(i,e)=>{const u=o("el-card"),w=o("el-input"),r=o("el-form-item"),E=o("el-option"),A=o("el-select"),h=o("el-date-picker"),V=o("el-col"),I=o("el-input-number"),K=o("el-icon"),O=o("el-upload"),P=o("el-button"),W=o("el-form"),F=o("el-tab-pane"),$=o("el-empty"),G=o("el-tag"),J=o("el-tabs"),Q=ae("loading");return d(),f("div",ie,[l(u,{class:"page-header"},{default:s(()=>[...e[10]||(e[10]=[n("h1",{class:"page-title"},"志愿时长申请",-1),n("p",{class:"subtitle"},"提交校外或其他志愿活动证明，申请增加志愿时长",-1)])]),_:1}),n("div",re,[l(J,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=t=>g.value=t),class:"custom-tabs"},{default:s(()=>[l(F,{label:"提交申请",name:"submit"},{default:s(()=>[l(u,null,{default:s(()=>[l(W,{ref_key:"formRef",ref:U,model:a,rules:L,"label-width":"100px","label-position":x.value},{default:s(()=>[l(r,{label:"活动名称",prop:"name"},{default:s(()=>[l(w,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=t=>a.name=t),placeholder:"请输入活动名称"},null,8,["modelValue"])]),_:1}),l(r,{label:"负责人",prop:"functionary"},{default:s(()=>[l(w,{modelValue:a.functionary,"onUpdate:modelValue":e[1]||(e[1]=t=>a.functionary=t),placeholder:"证明人或负责人姓名"},null,8,["modelValue"])]),_:1}),l(r,{label:"活动类型",prop:"type"},{default:s(()=>[l(A,{modelValue:a.type,"onUpdate:modelValue":e[2]||(e[2]=t=>a.type=t),placeholder:"请选择类型",style:{width:"100%"}},{default:s(()=>[(d(!0),f(C,null,B(k(D),t=>(d(),T(E,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"活动时间",required:""},{default:s(()=>[l(V,{span:11},{default:s(()=>[l(r,{prop:"startTime"},{default:s(()=>[l(h,{modelValue:a.startTime,"onUpdate:modelValue":e[3]||(e[3]=t=>a.startTime=t),type:"datetime",placeholder:"开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(V,{span:2,class:"text-center"},{default:s(()=>[...e[11]||(e[11]=[n("span",{class:"text-gray-500"},"-",-1)])]),_:1}),l(V,{span:11},{default:s(()=>[l(r,{prop:"endTime"},{default:s(()=>[l(h,{modelValue:a.endTime,"onUpdate:modelValue":e[4]||(e[4]=t=>a.endTime=t),type:"datetime",placeholder:"结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(r,{label:"申请时长",prop:"duration"},{default:s(()=>[l(I,{modelValue:a.duration,"onUpdate:modelValue":e[5]||(e[5]=t=>a.duration=t),min:.5,step:.5},null,8,["modelValue"]),e[12]||(e[12]=n("span",{class:"ml-2"},"小时",-1))]),_:1}),l(r,{label:"活动简述",prop:"description"},{default:s(()=>[l(w,{type:"textarea",modelValue:a.description,"onUpdate:modelValue":e[6]||(e[6]=t=>a.description=t),rows:3},null,8,["modelValue"])]),_:1}),l(r,{label:"证明材料"},{default:s(()=>[l(O,{"file-list":a.files,"onUpdate:fileList":e[7]||(e[7]=t=>a.files=t),action:"#","list-type":"picture-card","auto-upload":!1,"on-change":j,"on-remove":z,multiple:""},{default:s(()=>[l(K,null,{default:s(()=>[l(k(le))]),_:1})]),_:1},8,["file-list"]),e[13]||(e[13]=n("div",{class:"upload-tip"},"请上传活动照片或相关证明文件",-1))]),_:1}),l(r,null,{default:s(()=>[l(P,{type:"primary",onClick:e[8]||(e[8]=t=>H(U.value)),loading:c.value,class:"submit-btn"},{default:s(()=>[...e[14]||(e[14]=[p("提交申请",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","label-position"])]),_:1})]),_:1}),l(F,{label:"申请记录",name:"list"},{default:s(()=>[se((d(),f("div",de,[y.value.length===0?(d(),T($,{key:0,description:"暂无申请记录"})):(d(),f("div",ue,[(d(!0),f(C,null,B(y.value,t=>(d(),T(u,{key:t.id,class:"request-card",shadow:"hover"},{default:s(()=>[n("div",pe,[n("span",me,m(t.name),1),l(G,{type:M(t.status),effect:"dark",size:"small"},{default:s(()=>[p(m(N(t.status)),1)]),_:2},1032,["type"])]),n("div",ce,[n("div",fe,[e[15]||(e[15]=n("span",{class:"label"},"时间:",-1)),p(" "+m(new Date(t.startTime).toLocaleDateString()),1)]),n("div",_e,[e[16]||(e[16]=n("span",{class:"label"},"时长:",-1)),p(" "+m(t.duration)+" 小时",1)]),n("div",ve,[e[17]||(e[17]=n("span",{class:"label"},"类型:",-1)),p(" "+m(t.type),1)]),n("div",ge,[e[18]||(e[18]=n("span",{class:"label"},"描述:",-1)),p(" "+m(t.description),1)]),t.status===k(v).FailReview&&t.rejectedReason?(d(),f("div",ye,[e[19]||(e[19]=n("span",{class:"label"},"拒绝原因:",-1)),p(" "+m(t.rejectedReason),1)])):ne("",!0)])]),_:2},1024))),128))]))])),[[Q,c.value]])]),_:1})]),_:1},8,["modelValue"])])])}}}),Te=oe(be,[["__scopeId","data-v-13dc406c"]]);export{Te as default};
