import{d as O,r as k,V as Q,o as W,c as _,e,w as t,f as p,n as y,H as X,E as h,h as d,i as b,B as S,C as Y,k as w,m as n,t as o,K as j,F as M,j as N,s as Z,P as U,_ as ee}from"./index-BpHSPl7m.js";const te={class:"admin-review"},ae={class:"activity-card-list"},le={key:0,style:{"text-align":"center",padding:"20px",color:"#909399"}},ne={class:"card-header"},ie={class:"card-title"},se={class:"card-functionary"},oe={class:"card-description"},re={class:"card-actions"},de=["src"],ue={key:1},ce={key:1,class:"participants-section"},ve={class:"dialog-footer"},pe=O({__name:"AdminReview",setup(me){const u=k("normal"),m=k(!1),V=k([]),B=k([]),P=k([]),I=async()=>{m.value=!0;try{const s=await y.getActivities({status:X.UnderReview});V.value=s.items||[]}catch(s){console.error(s),h.error("加载审核列表失败")}finally{m.value=!1}},F=async()=>{m.value=!0;try{const s=await y.getPendingActivities();B.value=s.items||[]}catch(s){console.error(s),h.error("加载导入审核列表失败")}finally{m.value=!1}},H=async()=>{m.value=!0;try{P.value=await y.getPendingRequests()}catch(s){console.error(s),h.error("加载个人申请失败")}finally{m.value=!1}},R=()=>{u.value==="normal"?I():u.value==="imported"?F():H()};Q(u,R);const C=k(!1),i=k(null),q=k({}),z=s=>{i.value=s,C.value=!0;const a=s.participants||[];Promise.all(a.map(async g=>{if(!q.value[g]){const r=await Z.getUserByStudentNo(g);q.value[g]=r?.username||g}})).catch(()=>{})},$=async s=>{try{await U.confirm("确认通过该项目审核吗？","审核通过",{type:"success"}),u.value==="normal"?await y.reviewActivity(s.id,!0):u.value==="imported"?await y.approvePendingActivity(s.id):await y.reviewRequest(s.id,!0),h.success("已通过审核"),C.value=!1,R()}catch(a){a!=="cancel"&&h.error("操作失败")}},x=async s=>{try{const{value:a}=await U.prompt("请输入拒绝原因","审核拒绝",{confirmButtonText:"确认拒绝",cancelButtonText:"取消",inputPattern:/\S+/,inputErrorMessage:"拒绝原因不能为空",type:"warning"});u.value==="normal"?await y.reviewActivity(s.id,!1,a):u.value==="imported"?await y.rejectPendingActivity(s.id,a):await y.reviewRequest(s.id,!1,a),h.success("已拒绝"),C.value=!1,R()}catch(a){a!=="cancel"&&(console.error(a),h.error("操作失败"))}};return W(R),(s,a)=>{const g=p("el-card"),r=p("el-table-column"),A=p("el-link"),v=p("el-button"),E=p("el-table"),D=p("el-tab-pane"),K=p("el-tabs"),f=p("el-descriptions-item"),L=p("el-image"),G=p("el-descriptions"),J=p("el-dialog"),T=Y("loading");return d(),_("div",te,[e(g,{class:"page-header"},{default:t(()=>[...a[5]||(a[5]=[b("div",{class:"title"},"管理员审核",-1),b("div",{class:"subtitle"},"审核项目列表",-1)])]),_:1}),e(g,null,{default:t(()=>[e(K,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=l=>u.value=l)},{default:t(()=>[e(D,{label:"普通活动审核",name:"normal"},{default:t(()=>[S((d(),w(E,{data:V.value,style:{width:"100%"}},{default:t(()=>[e(r,{prop:"name",label:"名称","min-width":"160"}),e(r,{label:"负责人",width:"120"},{default:t(({row:l})=>[e(A,{type:"primary",onClick:c=>z(l)},{default:t(()=>[n(o(l.functionary),1)]),_:2},1032,["onClick"])]),_:1}),e(r,{prop:"description",label:"描述","min-width":"200"}),e(r,{label:"操作",width:"220"},{default:t(({row:l})=>[e(v,{size:"small",type:"success",onClick:c=>$(l)},{default:t(()=>[...a[6]||(a[6]=[n("通过",-1)])]),_:1},8,["onClick"]),e(v,{size:"small",type:"danger",onClick:c=>x(l)},{default:t(()=>[...a[7]||(a[7]=[n("拒绝",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,m.value]])]),_:1}),e(D,{label:"导入活动审核",name:"imported"},{default:t(()=>[S((d(),w(E,{data:B.value,style:{width:"100%"}},{default:t(()=>[e(r,{prop:"name",label:"名称","min-width":"160"}),e(r,{label:"提交人",width:"120"},{default:t(({row:l})=>[e(A,{type:"primary",onClick:c=>z(l)},{default:t(()=>[n(o(l.submittedBy||l.functionary),1)]),_:2},1032,["onClick"])]),_:1}),e(r,{prop:"description",label:"描述","min-width":"200"}),e(r,{label:"操作",width:"220"},{default:t(({row:l})=>[e(v,{size:"small",type:"success",onClick:c=>$(l)},{default:t(()=>[...a[8]||(a[8]=[n("通过",-1)])]),_:1},8,["onClick"]),e(v,{size:"small",type:"danger",onClick:c=>x(l)},{default:t(()=>[...a[9]||(a[9]=[n("拒绝",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,m.value]])]),_:1}),e(D,{label:"个人申请审核",name:"personal"},{default:t(()=>[S((d(),w(E,{data:P.value,style:{width:"100%"}},{default:t(()=>[e(r,{prop:"name",label:"名称","min-width":"160"}),e(r,{label:"申请人",width:"120"},{default:t(({row:l})=>[e(A,{type:"primary",onClick:c=>z(l)},{default:t(()=>[n(o(l.functionary),1)]),_:2},1032,["onClick"])]),_:1}),e(r,{label:"时长",width:"100"},{default:t(({row:l})=>[n(o(l.duration)+" 小时 ",1)]),_:1}),e(r,{prop:"description",label:"描述","min-width":"200"}),e(r,{label:"操作",width:"220"},{default:t(({row:l})=>[e(v,{size:"small",type:"success",onClick:c=>$(l)},{default:t(()=>[...a[10]||(a[10]=[n("通过",-1)])]),_:1},8,["onClick"]),e(v,{size:"small",type:"danger",onClick:c=>x(l)},{default:t(()=>[...a[11]||(a[11]=[n("拒绝",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,m.value]])]),_:1})]),_:1},8,["modelValue"]),S((d(),_("div",ae,[(u.value==="normal"?V.value:u.value==="imported"?B.value:P.value).length===0?(d(),_("div",le," 暂无审核中的项目 ")):j("",!0),(d(!0),_(M,null,N(u.value==="normal"?V.value:u.value==="imported"?B.value:P.value,l=>(d(),w(g,{key:l.id,class:"activity-card",shadow:"hover"},{default:t(()=>[b("div",ne,[b("div",ie,o(l.name),1),b("div",se,[e(A,{type:"primary",onClick:c=>z(l)},{default:t(()=>[n(o(l.functionary),1)]),_:2},1032,["onClick"])])]),b("div",oe,o(l.description),1),b("div",re,[e(v,{size:"small",type:"success",onClick:c=>$(l),block:""},{default:t(()=>[...a[12]||(a[12]=[n("通过",-1)])]),_:1},8,["onClick"]),e(v,{size:"small",type:"danger",onClick:c=>x(l),block:""},{default:t(()=>[...a[13]||(a[13]=[n("拒绝",-1)])]),_:1},8,["onClick"])])]),_:2},1024))),128))])),[[T,m.value]])]),_:1}),e(J,{modelValue:C.value,"onUpdate:modelValue":a[4]||(a[4]=l=>C.value=l),title:"活动详情",width:"90%",class:"review-dialog"},{footer:t(()=>[b("div",ve,[e(v,{onClick:a[1]||(a[1]=l=>C.value=!1)},{default:t(()=>[...a[14]||(a[14]=[n("关闭",-1)])]),_:1}),e(v,{type:"success",onClick:a[2]||(a[2]=l=>$(i.value))},{default:t(()=>[...a[15]||(a[15]=[n("通过",-1)])]),_:1}),e(v,{type:"danger",onClick:a[3]||(a[3]=l=>x(i.value))},{default:t(()=>[...a[16]||(a[16]=[n("拒绝",-1)])]),_:1})])]),default:t(()=>[i.value?(d(),w(G,{key:0,column:1,border:""},{default:t(()=>[e(f,{label:"名称"},{default:t(()=>[n(o(i.value.name),1)]),_:1}),e(f,{label:"负责人"},{default:t(()=>[n(o(i.value.functionary),1)]),_:1}),e(f,{label:"类型"},{default:t(()=>[n(o(i.value.type),1)]),_:1}),e(f,{label:"描述"},{default:t(()=>[n(o(i.value.description),1)]),_:1}),e(f,{label:"报名时间"},{default:t(()=>[n(o(i.value.EnrollmentStartTime)+" 至 "+o(i.value.EnrollmentEndTime),1)]),_:1}),e(f,{label:"活动时间"},{default:t(()=>[n(o(i.value.startTime)+" 至 "+o(i.value.endTime),1)]),_:1}),e(f,{label:"人数限制"},{default:t(()=>[n(o(i.value.maxParticipants),1)]),_:1}),e(f,{label:"时长"},{default:t(()=>[n(o(i.value.duration)+" 小时",1)]),_:1}),e(f,{label:"封面"},{default:t(()=>[i.value.CoverImage?(d(),_("img",{key:0,src:i.value.CoverImage,alt:"活动封面",style:{"max-width":"100%","max-height":"300px","object-fit":"contain"}},null,8,de)):(d(),_("span",ue,"无封面"))]),_:1}),i.value.Attachment&&i.value.Attachment.length?(d(),w(f,{key:0,label:"附件"},{default:t(()=>[(d(!0),_(M,null,N(i.value.Attachment,(l,c)=>(d(),_("div",{key:c,class:"attachment-item"},[l.match(/\.(jpg|jpeg|png|gif|bmp|webp)$/i)?(d(),w(L,{key:0,src:l,"preview-src-list":[l],fit:"cover",class:"attachment-img","hide-on-click-modal":""},null,8,["src","preview-src-list"])):(d(),w(A,{key:1,href:l,target:"_blank",type:"primary"},{default:t(()=>[n(o(l.split("/").pop()||"下载附件"),1)]),_:2},1032,["href"]))]))),128))]),_:1})):j("",!0)]),_:1})):j("",!0),i.value&&i.value.participants&&i.value.participants.length>0?(d(),_("div",ce,[b("h3",null,"导入/报名名单 (共 "+o(i.value.participants.length)+" 人)",1),e(E,{data:i.value.participants.map(l=>({id:l,username:q.value[l]||l})),height:"250",stripe:"",style:{width:"100%"},border:""},{default:t(()=>[e(r,{type:"index",width:"60",label:"序号"}),e(r,{prop:"id",label:"学号"}),e(r,{prop:"username",label:"姓名"})]),_:1},8,["data"])])):j("",!0)]),_:1},8,["modelValue"])])}}}),_e=ee(pe,[["__scopeId","data-v-844a6691"]]);export{_e as default};
