import{d as G,u as H,r as w,x as N,H as c,o as J,c as p,i as t,K as I,e as s,w as l,l as o,b as K,f as g,t as i,k as Z,Z as q,E as r,n as B,h as v,m as d,$ as O,I as Q,G as W,J as L,R,F as X,j as Y,D as ee,a0 as te,P as V,_ as ae}from"./index-BpHSPl7m.js";const se={class:"detail-page"},ne={class:"page-header"},le={key:0,class:"loading-state"},ie={key:1,class:"content-container"},oe={class:"banner-section"},re=["src"],ue={class:"banner-overlay"},ce={class:"activity-title"},de={class:"activity-meta"},ve={class:"main-content"},fe={class:"info-column"},me={class:"info-item"},_e={class:"value"},pe={class:"info-item"},ge={class:"time-block"},ye={class:"info-item"},he={class:"time-block"},we={class:"info-item"},Ee={class:"value"},Te={class:"action-area"},be={class:"attachment-list"},ke={class:"filename"},xe={class:"description-column"},Ae={class:"description-content"},Se=G({__name:"detail",setup(Ne){const M=q(),E=K(),f=H(),e=w(null),T=w(!0),y=w(!1),m=N(()=>{const n=f.studentNo.value;return!!e.value?.participants?.includes(n)}),h=N(()=>{if(!e.value)return!1;const n=e.value.EnrollmentEndTime?new Date(e.value.EnrollmentEndTime).getTime():0,a=Date.now(),u=e.value.functionary!==f.studentNo.value;return m.value&&u&&a<=n}),C=w(""),b=async()=>{const n=M.params.id;if(!n){r.error("未找到活动ID");return}T.value=!0;try{const a=await B.getActivityById(n);a?(e.value=a,a.functionary&&(C.value=a.functionary)):(console.warn(`Activity with id ${n} not found`),r.error({message:"未找到该活动",duration:3e3}),setTimeout(()=>{E.push("/activities")},1500))}catch(a){console.error("Failed to fetch activity:",a),r.error({message:"加载活动详情失败，请检查网络连接后重试",duration:3e3})}finally{T.value=!1}},U=async()=>{if(e.value){if(!f.isLoggedIn.value){r.warning("请先登录"),await E.push("/login");return}if(m.value&&e.value.functionary===f.studentNo.value){r.warning("负责人无法退出自己负责的项目");return}try{if(m.value){if(!h.value){r.warning("报名已结束或负责人账号，无法取消报名");return}await V.confirm("确定要取消报名吗？","取消确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),y.value=!0;const n=await B.unenrollActivity(e.value.id);n.code===200?(r.success("已取消报名"),await b()):r.error(n.message||"取消报名失败")}else{await V.confirm("确定要报名参加该活动吗？","报名确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),y.value=!0;const n=await B.enrollActivity(e.value.id);n.code===200?(r.success("报名成功"),await b()):r.error(n.message||"报名失败")}}catch(n){n!=="cancel"&&(console.error("Enrollment toggle failed:",n),r.error("操作失败"))}finally{y.value=!1}}},_=n=>n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"暂无",F=Q,$=W,P=n=>{switch(n){case c.EnrollmentStarted:return"success";case c.EnrollmentNotStart:return"info";case c.EnrollmentEnded:case c.ActivityStarted:return"warning";case c.ActivityEnded:return"info";case c.UnderReview:return"info";case c.FailReview:return"danger";default:return"info"}},D=N(()=>e.value?m.value?h.value:e.value.status===c.EnrollmentStarted&&!e.value.isFull:!1);return J(()=>{b()}),(n,a)=>{const u=g("el-icon"),k=g("el-button"),j=g("el-skeleton"),x=g("el-tag"),A=g("el-card");return v(),p("div",se,[t("div",ne,[s(k,{link:"",onClick:a[0]||(a[0]=S=>o(E).back()),class:"back-btn"},{default:l(()=>[s(u,null,{default:l(()=>[s(o(O))]),_:1}),a[2]||(a[2]=d(" 返回列表 ",-1))]),_:1})]),T.value?(v(),p("div",le,[s(j,{rows:10,animated:""})])):e.value?(v(),p("div",ie,[t("div",oe,[t("img",{src:e.value.CoverImage||"/src/image/activity-card-bg.png",class:"banner-image",onError:a[1]||(a[1]=S=>S.target.src="/src/image/activity-card-bg.png")},null,40,re),t("div",ue,[t("h1",ce,i(e.value.name),1),t("div",de,[s(x,{type:P(e.value.status),effect:"dark",size:"large"},{default:l(()=>[d(i(o(F)(e.value.status)),1)]),_:1},8,["type"]),s(x,{effect:"plain",type:"info",size:"large"},{default:l(()=>[d(i(o($)(e.value.type)),1)]),_:1})])])]),t("div",ve,[t("div",fe,[s(A,{class:"info-card",shadow:"hover"},{header:l(()=>[...a[3]||(a[3]=[t("div",{class:"card-header"},[t("span",null,"活动信息")],-1)])]),default:l(()=>[t("div",me,[s(u,null,{default:l(()=>[s(o(L))]),_:1}),a[4]||(a[4]=t("span",{class:"label"},"负责人:",-1)),t("span",_e,i(C.value||e.value.functionary),1)]),t("div",pe,[s(u,null,{default:l(()=>[s(o(R))]),_:1}),a[6]||(a[6]=t("span",{class:"label"},"报名时间:",-1)),t("div",ge,[t("div",null,i(_(e.value.EnrollmentStartTime)),1),a[5]||(a[5]=t("div",{class:"to"},"至",-1)),t("div",null,i(_(e.value.EnrollmentEndTime)),1)])]),t("div",ye,[s(u,null,{default:l(()=>[s(o(R))]),_:1}),a[7]||(a[7]=t("span",{class:"label"},"活动时间:",-1)),t("div",he,[t("div",null,"开始: "+i(_(e.value.startTime)),1),t("div",null,"预计结束: "+i(_(e.value.expectedEndTime)),1),t("div",null,"实际结束: "+i(e.value.endTime?_(e.value.endTime):"活动未结束"),1)])]),t("div",we,[s(u,null,{default:l(()=>[s(o(L))]),_:1}),a[8]||(a[8]=t("span",{class:"label"},"参与人数:",-1)),t("span",Ee,[d(i(e.value.participants?.length||0)+" / "+i(e.value.maxParticipants)+" ",1),s(x,{size:"small",type:e.value.isFull?"danger":"success",class:"ml-2"},{default:l(()=>[d(i(e.value.isFull?"已满员":"未满员"),1)]),_:1},8,["type"])])]),t("div",Te,[s(k,{type:"primary",size:"large",class:"enroll-btn",disabled:!D.value&&!h.value,loading:y.value,onClick:U},{default:l(()=>[d(i(m.value?e.value.functionary===o(f).studentNo.value?"负责人(不可退出)":h.value?"取消报名":"报名结束(不可取消)":D.value?"立即报名":o(F)(e.value.status)),1)]),_:1},8,["disabled","loading"])])]),_:1}),e.value.Attachment&&e.value.Attachment.length>0?(v(),Z(A,{key:0,class:"info-card mt-4",shadow:"hover"},{header:l(()=>[...a[9]||(a[9]=[t("div",{class:"card-header"},[t("span",null,"附件下载")],-1)])]),default:l(()=>[t("div",be,[(v(!0),p(X,null,Y(e.value.Attachment,(S,z)=>(v(),p("div",{key:z,class:"attachment-item"},[s(u,null,{default:l(()=>[s(o(ee))]),_:1}),t("span",ke,"附件 "+i(z+1),1),s(k,{link:"",type:"primary",size:"small"},{default:l(()=>[s(u,null,{default:l(()=>[s(o(te))]),_:1}),a[10]||(a[10]=d(" 下载 ",-1))]),_:1})]))),128))])]),_:1})):I("",!0)]),t("div",xe,[s(A,{class:"description-card",shadow:"never"},{default:l(()=>[a[11]||(a[11]=t("h2",{class:"section-title"},"活动详情",-1)),t("div",Ae,i(e.value.description||"暂无详细描述"),1)]),_:1})])])])):I("",!0)])}}}),Ce=ae(Se,[["__scopeId","data-v-02a2983a"]]);export{Ce as default};
